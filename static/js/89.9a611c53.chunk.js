"use strict";(self.webpackChunkriesgosapp=self.webpackChunkriesgosapp||[]).push([[89],{8089:(e,o,t)=>{t.r(o),t.d(o,{default:()=>E});var r=t(5043),n=t(9419),i=t(6036),a=t(1842),l=t(3318),s=t(2023),c=t(228),d=t.n(c),p=t(4799),u=t(5895),h=t(1725),x=t(8865),g=t(2097),m=t(3969),f=t(3830),y=t(8640),b=t(3204),j=t(6885),C=t(2540),v=t(6005),k=t(218),w=(t(8814),t(579));delete d().Icon.Default.prototype._getIconUrl,d().Icon.Default.mergeOptions({iconRetinaUrl:t(8249).default,iconUrl:t(7024).default,shadowUrl:t(1071).default});const I=[-3.9939,-79.2042],S={Alta:"#dc3545",Media:"#ffc107",Baja:"#28a745",DEFAULT:"#007bff"},A={tipo1:{color:"#ffff00",fillColor:"#ffff00",fillOpacity:.2},tipo2:{color:"#0000ff",fillColor:"#0000ff",fillOpacity:.2},parroquia:{color:"#050505",fillColor:"#b6b1b1",fillOpacity:.2}},D={"Movimiento en masas":{icon:b.FhS,color:"#FF5733"},"Inundaci\xf3n":{icon:b.PYU,color:"Blue"},"Colapso estructural":{icon:b.ymh,color:"Blue"},default:{icon:b.BS8,color:"#080808"}},z=e=>{let{src:o,onClose:t}=e;return(0,w.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:"20px"},onClick:t,role:"dialog","aria-label":"Imagen expandida",children:(0,w.jsxs)("div",{style:{maxWidth:"90%",maxHeight:"90%",position:"relative"},onClick:e=>e.stopPropagation(),children:[(0,w.jsx)("img",{src:o,alt:"Imagen expandida",style:{maxWidth:"100%",maxHeight:"90vh",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0,0,0,0.25)"}}),(0,w.jsx)("button",{onClick:t,style:{position:"absolute",top:"-15px",right:"-15px",background:"#dc3545",color:"white",border:"none",borderRadius:"50%",width:"30px",height:"30px",fontSize:"16px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Cerrar imagen",children:"\xd7"})]})})},F=e=>{let{showLayer:o,onToggle:t}=e;return(0,w.jsxs)(p.A,{sx:{position:"absolute",top:10,right:10,zIndex:1e3,padding:2,backgroundColor:"rgba(255, 255, 255, 0.95)",borderRadius:2,boxShadow:3,minWidth:200},children:[(0,w.jsx)(u.A,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"Control de Capas"}),(0,w.jsx)(h.A,{control:(0,w.jsx)(x.A,{checked:o,onChange:t,color:"primary","aria-label":"Mostrar capa de pol\xedgonos"}),label:"Mostrar capa de pol\xedgonos"})]})},$=e=>{let{afectData:o=[],parroquia:t=[],loading:d=!1,error:p=null,coords:h=[],extractCoordinates:x,selectedDate:b,setSelectedDate:$,minFecha:E,maxFecha:R}=e;const[M,B]=(0,r.useState)(null),[P,L]=(0,r.useState)(null),[q,T]=(0,r.useState)(!1),[O,U]=(0,r.useState)(null),[N,W]=(0,r.useState)([]),[H,_]=(0,r.useState)(!1);(0,r.useEffect)(()=>{try{const e=localStorage.getItem("user");e&&L(JSON.parse(e))}catch(p){console.error("Error al cargar usuario:",p)}},[]),(0,r.useEffect)(()=>{(async()=>{if(q&&0===N.length){_(!0);try{const e=await(0,k.J3)();W(e||[])}catch(p){console.error("Error al cargar pol\xedgonos:",p)}finally{_(!1)}}})()},[q,N.length]);const Y=(0,r.useCallback)(async e=>{try{const o=await(0,v.OC)(e);o&&U(o)}catch(p){console.error("Error al cargar datos del item:",p)}},[]),G=(0,r.useCallback)(e=>"number"===typeof e?e.toFixed(6):"0.000000",[]),J=(0,r.useCallback)((e,o)=>{const t=S[o]||S.DEFAULT,r=D[e]||D.default,n=r.icon,i={display:"flex",alignItems:"center",justifyContent:"center",background:t,borderRadius:"50%",width:"24px",height:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},a=(0,j.F0)((0,w.jsx)("div",{style:i,children:(0,w.jsx)(n,{color:r.color,size:14})}));return(0,c.divIcon)({html:a,className:"custom-leaflet-icon",iconSize:[30,30],iconAnchor:[15,30]})},[]),X=(0,r.useCallback)((e,o,t)=>{const r=S[o]||S.DEFAULT,n=(D[e]||D.default).icon,i=40*(t/25),a=i,l=.75*i,s=(0,j.F0)((0,w.jsxs)("div",{style:{position:"relative",width:`${a}px`,height:`${a}px`,display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,w.jsx)("div",{style:{position:"absolute",width:`${a}px`,height:`${a}px`,borderRadius:"50%",backgroundColor:r,opacity:.3,animation:"pulse 2s infinite"}}),(0,w.jsx)("div",{style:{position:"absolute",width:`${l}px`,height:`${l}px`,borderRadius:"50%",backgroundColor:r,opacity:.5,animation:"pulse 2s infinite",animationDelay:"0.5s"}}),(0,w.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",background:r,borderRadius:"50%",width:"24px",height:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",zIndex:10,position:"relative"},children:(0,w.jsx)(n,{color:"white",size:12})})]}));return(0,c.divIcon)({html:s,className:`custom-leaflet-icon emergency-alert radio-${Math.round(t)}`,iconSize:[a,a],iconAnchor:[a/2,a]})},[]),Z=(0,r.useMemo)(()=>o.map((e,o)=>{try{if(null===e||void 0===e||!e.geom)return console.warn("Item sin geometr\xeda:",e),null;const t=null===x||void 0===x?void 0:x(e.geom);if(!t||"number"!==typeof t.lat||"number"!==typeof t.lng)return console.warn("Coordenadas inv\xe1lidas para el item:",e),null;const r=e.event||"default",n=e.prioridad||"DEFAULT";return(0,w.jsx)(i.p,{position:[t.lat,t.lng],icon:e.radio>0&&"Alta"==n&&"Pendiente"==e.estado?X(r,n,e.radio):J(r,n),eventHandlers:{click:()=>Y(e.id)},children:(null===O||void 0===O?void 0:O.id)===e.id&&(0,w.jsx)(l.z,{children:(0,w.jsxs)("div",{children:[(0,w.jsx)("h4",{children:`${e.id} - ${r}`}),O.anex_foto&&(0,w.jsx)("div",{style:{marginTop:"10px",position:"relative"},children:(()=>{const e=O.anex_foto.split(",").map(e=>e.trim()).filter(e=>e.length>0);if(1===e.length)return(0,w.jsxs)("div",{children:[(0,w.jsx)("img",{src:e[0],alt:`Imagen de ${O.nombre||"afectaci\xf3n"}`,style:{width:"100%",height:"200px",objectFit:"contain",borderRadius:"4px",border:"1px solid #ddd",cursor:"pointer",backgroundColor:"#f5f5f5"},onClick:()=>B(e[0])}),(0,w.jsx)("p",{style:{fontSize:"0.8em",color:"#666",textAlign:"center",marginTop:"4px"},children:"Haz clic para ampliar"})]});let o=0;return(0,w.jsxs)("div",{style:{height:"220px"},children:[(0,w.jsxs)("div",{id:"imageCarousel",style:{position:"relative",height:"200px"},children:[e.length>1&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("button",{onClick:t=>{t.stopPropagation();const r=document.getElementById("imageCarousel").querySelector("img");o=0===o?e.length-1:o-1,r.src=e[o];const n=document.getElementById("currentIndicator");n&&(n.textContent=`${o+1}/${e.length}`)},style:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)",zIndex:2,background:"rgba(0,0,0,0.5)",color:"white",border:"none",borderRadius:"50%",width:"30px",height:"30px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:"<"}),(0,w.jsx)("button",{onClick:t=>{t.stopPropagation();const r=document.getElementById("imageCarousel").querySelector("img");o=o===e.length-1?0:o+1,r.src=e[o];const n=document.getElementById("currentIndicator");n&&(n.textContent=`${o+1}/${e.length}`)},style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",zIndex:2,background:"rgba(0,0,0,0.5)",color:"white",border:"none",borderRadius:"50%",width:"30px",height:"30px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:">"})]}),(0,w.jsx)("img",{src:e[0],alt:`Imagen 1 de ${e.length}`,style:{width:"100%",height:"200px",objectFit:"contain",borderRadius:"4px",border:"1px solid #ddd",cursor:"pointer",backgroundColor:"#f5f5f5"},onClick:()=>B(e[o])}),e.length>1&&(0,w.jsx)("div",{style:{position:"absolute",bottom:"10px",left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.7)",color:"white",padding:"2px 10px",borderRadius:"10px",fontSize:"0.8em"},children:(0,w.jsxs)("span",{id:"currentIndicator",children:["1/",e.length]})})]}),e.length>1&&(0,w.jsx)("div",{style:{display:"flex",justifyContent:"center",gap:"6px",marginTop:"8px",height:"12px"},children:e.map((t,r)=>(0,w.jsx)("button",{onClick:t=>{t.stopPropagation();const n=document.getElementById("imageCarousel").querySelector("img");o=r,n.src=e[o];const i=document.getElementById("currentIndicator");i&&(i.textContent=`${o+1}/${e.length}`)},style:{width:"10px",height:"10px",borderRadius:"50%",border:"none",backgroundColor:r===o?"orange":"#ccc",cursor:"pointer",padding:0},"aria-label":`Ir a imagen ${r+1}`},r))}),(0,w.jsx)("p",{style:{fontSize:"0.8em",color:"#666",textAlign:"center",marginTop:"4px"},children:"Haz clic en la imagen para ampliar"})]})})()}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Fecha:"})," ",O.date||"No disponible"]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Sector:"})," ",O.sector||"No disponible"]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Ubicaci\xf3n:"})," ",G(t.lat),","," ",G(t.lng)]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Prioridad:"}),(0,w.jsxs)("span",{style:{color:S[n]||S.DEFAULT},children:[" ",n]})]}),O.descripcio&&(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Descripci\xf3n:"})," ",O.descripcio]}),P&&(0,w.jsx)(g.A,{onClick:()=>(0,v.lM)(O.event,t.lat,t.lng,O,P),fullWidth:!0,sx:{background:"linear-gradient(45deg, #FF5733 20%, #FFD700 90%)",marginTop:"16px",fontWeight:"bold"},variant:"contained",children:"Generar Reporte PDF"})]})})},`marker-${e.id||`index-${o}`}`)}catch(p){return console.error("Error al renderizar marcador:",e,p),null}}).filter(Boolean),[o,O,P,G,J,Y,x]),K=(0,r.useMemo)(()=>!q||H?null:N.flatMap((e,o)=>{try{var t;return null!==e&&void 0!==e&&null!==(t=e.geom)&&void 0!==t&&t.coordinates?e.geom.coordinates.map((t,r)=>{const n=t[0].map(e=>[e[1],e[0]]),i=1===e.tipo?A.tipo1:A.tipo2;return(0,w.jsx)(a.t,{positions:n,pathOptions:{color:i.color,fillColor:i.fillColor,fillOpacity:i.fillOpacity,weight:2},children:(0,w.jsx)(l.z,{children:(0,w.jsxs)("div",{children:[(0,w.jsxs)("h4",{children:["Pol\xedgono ",e.id]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Descripci\xf3n:"})," ",e.Descripcio||"Sin descripci\xf3n"]})]})})},`poligono-${e.id}-${o}-${r}`)}):null}catch(p){return console.error("Error al renderizar pol\xedgono:",e,p),null}}).filter(Boolean),[N,q,H]),Q=(0,r.useMemo)(()=>t.flatMap((e,o)=>null!==e&&void 0!==e&&e.geom&&"MultiPolygon"===e.geom.type?e.geom.coordinates.map((t,r)=>{const n=t[0].map(e=>[e[1],e[0]]);return(0,w.jsx)(a.t,{positions:n,pathOptions:{color:A.parroquia.color,fillColor:A.parroquia.fillColor,fillOpacity:A.parroquia.fillOpacity,weight:2},children:(0,w.jsxs)(l.z,{children:[(0,w.jsx)("strong",{children:"Parroquia:"})," ",e.DPA_DESPAR||"Sin nombre"]})},`parroquia-${e.id||o}-${r}`)}):null).filter(Boolean),[t]),V=(0,r.useMemo)(()=>{if(h&&h.length>=2){const e=parseFloat(h[0]),o=parseFloat(h[1]);if(!isNaN(e)&&!isNaN(o))return[e,o]}return I},[h]);return d?(0,w.jsxs)(m.A,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:[(0,w.jsx)("img",{src:C,alt:"Cargando mapa..."}),(0,w.jsx)(u.A,{variant:"body1",sx:{mt:2},children:"Cargando datos del mapa..."})]}):p?(0,w.jsxs)(f.A,{severity:"error",sx:{m:2},children:["Error: ",p]}):o.length?(0,w.jsxs)(m.A,{sx:{position:"relative"},children:[(0,w.jsx)("style",{children:"\n          .leaflet-pulse-circle {\n            animation: pulse 2s infinite;\n            opacity: 0.3;\n          }\n          \n          @keyframes pulse {\n            0% {\n              transform: scale(0.9);\n              opacity: 0.5;\n            }\n            70% {\n              transform: scale(1.2);\n              opacity: 0.2;\n            }\n            100% {\n              transform: scale(0.9);\n              opacity: 0.5;\n            }\n          }\n        "}),(0,w.jsx)(F,{showLayer:q,onToggle:e=>T(e.target.checked)}),(0,w.jsxs)(n.W,{center:V,zoom:14,style:{height:"75vh",width:"100%"},scrollWheelZoom:!0,children:[(0,w.jsx)(s.e,{url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",attribution:"\xa9 Google Maps"}),Z,K,Q,H&&(0,w.jsx)("div",{style:{position:"absolute",top:"10px",left:"10px",zIndex:1e3,background:"white",padding:"5px 10px",borderRadius:"4px",fontSize:"12px"},children:"Cargando pol\xedgonos..."})]}),M&&(0,w.jsx)(z,{src:M,onClose:()=>B(null)}),E&&R&&(0,w.jsxs)(m.A,{sx:{width:"90%",margin:"30px auto 0 auto"},children:[(0,w.jsx)(y.Ay,{value:b||R,min:E,max:R,step:864e5,onChange:(e,o)=>$(o),valueLabelDisplay:"auto",valueLabelFormat:e=>new Date(e).toLocaleDateString("es-EC",{year:"numeric",month:"short",day:"numeric"}),sx:{color:"orange",height:8,"& .MuiSlider-thumb":{backgroundColor:"#fff",border:"2px solid orange"},"& .MuiSlider-valueLabel":{backgroundColor:"orange",color:"#fff",borderRadius:"4px",padding:"4px 8px"}}}),(0,w.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",marginTop:"-10px",fontSize:"0.75rem",color:"text.secondary"},children:[(0,w.jsx)("span",{children:new Date(E).toLocaleDateString("es-EC",{year:"numeric",month:"short",day:"numeric"})}),(0,w.jsx)("span",{children:new Date(R).toLocaleDateString("es-EC",{year:"numeric",month:"short",day:"numeric"})})]})]})]}):(0,w.jsxs)(m.A,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"60vh",textAlign:"center",p:3,children:[(0,w.jsx)(u.A,{variant:"h5",gutterBottom:!0,color:"textSecondary",children:"No hay datos de afectaciones"}),(0,w.jsx)(u.A,{variant:"body1",color:"textSecondary",children:"La b\xfasqueda realizada no ha encontrado datos de afectaciones. Por favor, intente con otra fecha, prioridad o criterios de b\xfasqueda."})]})};$.defaultProps={afectData:[],parroquia:[],loading:!1,error:null,coords:[],selectedDate:null,minFecha:null,maxFecha:null,radioAfect:1e3};const E=r.memo($)}}]);
//# sourceMappingURL=89.9a611c53.chunk.js.map