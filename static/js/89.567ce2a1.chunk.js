"use strict";(self.webpackChunkriesgosapp=self.webpackChunkriesgosapp||[]).push([[89],{8089:(e,o,r)=>{r.r(o),r.d(o,{default:()=>$});var t=r(5043),n=r(9419),i=r(6036),a=r(1842),l=r(3318),s=r(2023),c=r(228),d=r.n(c),p=r(4799),u=r(5895),x=r(1725),h=r(8865),g=r(2097),f=r(3969),m=r(3830),y=r(9958),b=r(3204),j=r(6885),C=r(2540),v=r(6005),S=r(218),w=(r(8814),r(579));delete d().Icon.Default.prototype._getIconUrl,d().Icon.Default.mergeOptions({iconRetinaUrl:r(8249).default,iconUrl:r(7024).default,shadowUrl:r(1071).default});const A=[-3.9939,-79.2042],k={Alta:"#dc3545",Media:"#ffc107",Baja:"#28a745",DEFAULT:"#007bff"},D={tipo1:{color:"#ffff00",fillColor:"#ffff00",fillOpacity:.2},tipo2:{color:"#0000ff",fillColor:"#0000ff",fillOpacity:.2},parroquia:{color:"#050505",fillColor:"#b6b1b1",fillOpacity:.2}},F={"Movimiento en masas":{icon:b.FhS,color:"#FF5733"},"Inundaci\xf3n":{icon:b.PYU,color:"Blue"},"Colapso estructural":{icon:b.ymh,color:"Blue"},default:{icon:b.BS8,color:"#080808"}},z=e=>{let{src:o,onClose:r}=e;return(0,w.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:"20px"},onClick:r,role:"dialog","aria-label":"Imagen expandida",children:(0,w.jsxs)("div",{style:{maxWidth:"90%",maxHeight:"90%",position:"relative"},onClick:e=>e.stopPropagation(),children:[(0,w.jsx)("img",{src:o,alt:"Imagen expandida",style:{maxWidth:"100%",maxHeight:"90vh",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0,0,0,0.25)"}}),(0,w.jsx)("button",{onClick:r,style:{position:"absolute",top:"-15px",right:"-15px",background:"#dc3545",color:"white",border:"none",borderRadius:"50%",width:"30px",height:"30px",fontSize:"16px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Cerrar imagen",children:"\xd7"})]})})},I=e=>{let{showLayer:o,onToggle:r}=e;return(0,w.jsxs)(p.A,{sx:{position:"absolute",top:10,right:10,zIndex:1e3,padding:2,backgroundColor:"rgba(255, 255, 255, 0.95)",borderRadius:2,boxShadow:3,minWidth:200},children:[(0,w.jsx)(u.A,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"Control de Capas"}),(0,w.jsx)(x.A,{control:(0,w.jsx)(h.A,{checked:o,onChange:r,color:"primary","aria-label":"Mostrar capa de pol\xedgonos"}),label:"Mostrar capa de pol\xedgonos"})]})},E=e=>{let{afectData:o=[],parroquia:r=[],loading:d=!1,error:p=null,coords:x=[],extractCoordinates:h,selectedDate:b,setSelectedDate:E,minFecha:$,maxFecha:M,radioAfect:L}=e;const[R,O]=(0,t.useState)(null),[P,U]=(0,t.useState)(null),[q,N]=(0,t.useState)(!1),[T,B]=(0,t.useState)(null),[W,H]=(0,t.useState)([]),[_,G]=(0,t.useState)(!1);(0,t.useEffect)(()=>{try{const e=localStorage.getItem("user");e&&U(JSON.parse(e))}catch(p){console.error("Error al cargar usuario:",p)}},[]),(0,t.useEffect)(()=>{(async()=>{if(q&&0===W.length){G(!0);try{const e=await(0,S.J3)();H(e||[])}catch(p){console.error("Error al cargar pol\xedgonos:",p)}finally{G(!1)}}})()},[q,W.length]);const J=(0,t.useCallback)(async e=>{try{const o=await(0,v.OC)(e);o&&B(o)}catch(p){console.error("Error al cargar datos del item:",p)}},[]),Y=(0,t.useCallback)(e=>"number"===typeof e?e.toFixed(6):"0.000000",[]),Z=(0,t.useCallback)((e,o)=>{const r=k[o]||k.DEFAULT,t=F[e]||F.default,n=t.icon,i={display:"flex",alignItems:"center",justifyContent:"center",background:r,borderRadius:"50%",width:"24px",height:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},a=(0,j.F0)((0,w.jsx)("div",{style:i,children:(0,w.jsx)(n,{color:t.color,size:14})}));return(0,c.divIcon)({html:a,className:"custom-leaflet-icon",iconSize:[30,30],iconAnchor:[15,30]})},[]),K=(0,t.useCallback)((e,o,r)=>{const t=k[o]||k.DEFAULT,n=(F[e]||F.default).icon,i=40*(r/25),a=i,l=.75*i,s=(0,j.F0)((0,w.jsxs)("div",{style:{position:"relative",width:`${a}px`,height:`${a}px`,display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,w.jsx)("div",{style:{position:"absolute",width:`${a}px`,height:`${a}px`,borderRadius:"50%",backgroundColor:t,opacity:.3,animation:"pulse 2s infinite"}}),(0,w.jsx)("div",{style:{position:"absolute",width:`${l}px`,height:`${l}px`,borderRadius:"50%",backgroundColor:t,opacity:.5,animation:"pulse 2s infinite",animationDelay:"0.5s"}}),(0,w.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",background:t,borderRadius:"50%",width:"24px",height:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",zIndex:10,position:"relative"},children:(0,w.jsx)(n,{color:"white",size:12})})]}));return(0,c.divIcon)({html:s,className:`custom-leaflet-icon emergency-alert radio-${Math.round(r)}`,iconSize:[a,a],iconAnchor:[a/2,a]})},[]),Q=(0,t.useMemo)(()=>o.map((e,o)=>{try{if(null===e||void 0===e||!e.geom)return console.warn("Item sin geometr\xeda:",e),null;const r=null===h||void 0===h?void 0:h(e.geom);if(!r||"number"!==typeof r.lat||"number"!==typeof r.lng)return console.warn("Coordenadas inv\xe1lidas para el item:",e),null;const t=e.event||"default",n=e.prioridad||"DEFAULT";return console.log(e),(0,w.jsx)(i.p,{position:[r.lat,r.lng],icon:e.radio>0&&"Alta"==n&&"Pendiente"==e.estado?K(t,n,e.radio):Z(t,n),eventHandlers:{click:()=>J(e.id)},children:(null===T||void 0===T?void 0:T.id)===e.id&&(0,w.jsx)(l.z,{children:(0,w.jsxs)("div",{children:[(0,w.jsx)("h4",{children:`${e.id} - ${t}`}),T.anex_foto&&(0,w.jsxs)("div",{style:{marginTop:"10px"},children:[(0,w.jsx)("img",{src:T.anex_foto,alt:`Imagen de ${T.nombre||"afectaci\xf3n"}`,style:{width:"100%",height:"auto",maxHeight:"200px",objectFit:"contain",borderRadius:"4px",border:"1px solid #ddd",cursor:"pointer"},onClick:()=>O(T.anex_foto)}),(0,w.jsx)("p",{style:{fontSize:"0.8em",color:"#666",textAlign:"center"},children:"Haz clic para ampliar"})]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Fecha:"})," ",T.date||"No disponible"]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Sector:"})," ",T.sector||"No disponible"]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Ubicaci\xf3n:"})," ",Y(r.lat),", ",Y(r.lng)]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Prioridad:"}),(0,w.jsxs)("span",{style:{color:k[n]||k.DEFAULT},children:[" ",n]})]}),T.descripcio&&(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Descripci\xf3n:"})," ",T.descripcio]}),P&&(0,w.jsx)(g.A,{onClick:()=>(0,v.lM)(T.event,r.lat,r.lng,T,P),fullWidth:!0,sx:{background:"linear-gradient(45deg, #FF5733 20%, #FFD700 90%)",marginTop:"16px",fontWeight:"bold"},variant:"contained",children:"Generar Reporte PDF"})]})})},`marker-${e.id||`index-${o}`}`)}catch(p){return console.error("Error al renderizar marcador:",e,p),null}}).filter(Boolean),[o,T,P,Y,Z,J,h]),V=(0,t.useMemo)(()=>!q||_?null:W.flatMap((e,o)=>{try{var r;return null!==e&&void 0!==e&&null!==(r=e.geom)&&void 0!==r&&r.coordinates?e.geom.coordinates.map((r,t)=>{const n=r[0].map(e=>[e[1],e[0]]),i=1===e.tipo?D.tipo1:D.tipo2;return(0,w.jsx)(a.t,{positions:n,pathOptions:{color:i.color,fillColor:i.fillColor,fillOpacity:i.fillOpacity,weight:2},children:(0,w.jsx)(l.z,{children:(0,w.jsxs)("div",{children:[(0,w.jsxs)("h4",{children:["Pol\xedgono ",e.id]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Descripci\xf3n:"})," ",e.Descripcio||"Sin descripci\xf3n"]})]})})},`poligono-${e.id}-${o}-${t}`)}):null}catch(p){return console.error("Error al renderizar pol\xedgono:",e,p),null}}).filter(Boolean),[W,q,_]),X=(0,t.useMemo)(()=>r.flatMap((e,o)=>null!==e&&void 0!==e&&e.geom&&"MultiPolygon"===e.geom.type?e.geom.coordinates.map((r,t)=>{const n=r[0].map(e=>[e[1],e[0]]);return(0,w.jsx)(a.t,{positions:n,pathOptions:{color:D.parroquia.color,fillColor:D.parroquia.fillColor,fillOpacity:D.parroquia.fillOpacity,weight:2},children:(0,w.jsxs)(l.z,{children:[(0,w.jsx)("strong",{children:"Parroquia:"})," ",e.DPA_DESPAR||"Sin nombre"]})},`parroquia-${e.id||o}-${t}`)}):null).filter(Boolean),[r]),ee=(0,t.useMemo)(()=>{if(x&&x.length>=2){const e=parseFloat(x[0]),o=parseFloat(x[1]);if(!isNaN(e)&&!isNaN(o))return[e,o]}return A},[x]);return d?(0,w.jsxs)(f.A,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:[(0,w.jsx)("img",{src:C,alt:"Cargando mapa..."}),(0,w.jsx)(u.A,{variant:"body1",sx:{mt:2},children:"Cargando datos del mapa..."})]}):p?(0,w.jsxs)(m.A,{severity:"error",sx:{m:2},children:["Error: ",p]}):o.length?(0,w.jsxs)(f.A,{sx:{position:"relative"},children:[(0,w.jsx)("style",{children:"\n          .leaflet-pulse-circle {\n            animation: pulse 2s infinite;\n            opacity: 0.3;\n          }\n          \n          @keyframes pulse {\n            0% {\n              transform: scale(0.9);\n              opacity: 0.5;\n            }\n            70% {\n              transform: scale(1.2);\n              opacity: 0.2;\n            }\n            100% {\n              transform: scale(0.9);\n              opacity: 0.5;\n            }\n          }\n        "}),(0,w.jsx)(I,{showLayer:q,onToggle:e=>N(e.target.checked)}),(0,w.jsxs)(n.W,{center:ee,zoom:14,style:{height:"75vh",width:"100%"},scrollWheelZoom:!0,children:[(0,w.jsx)(s.e,{url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",attribution:"\xa9 Google Maps"}),Q,V,X,_&&(0,w.jsx)("div",{style:{position:"absolute",top:"10px",left:"10px",zIndex:1e3,background:"white",padding:"5px 10px",borderRadius:"4px",fontSize:"12px"},children:"Cargando pol\xedgonos..."})]}),R&&(0,w.jsx)(z,{src:R,onClose:()=>O(null)}),$&&M&&(0,w.jsxs)(f.A,{sx:{width:"90%",margin:"30px auto 0 auto"},children:[(0,w.jsx)(y.Ay,{value:b||M,min:$,max:M,step:864e5,onChange:(e,o)=>E(o),valueLabelDisplay:"auto",valueLabelFormat:e=>new Date(e).toLocaleDateString("es-EC",{year:"numeric",month:"short",day:"numeric"}),sx:{color:"orange",height:8,"& .MuiSlider-thumb":{backgroundColor:"#fff",border:"2px solid orange"},"& .MuiSlider-valueLabel":{backgroundColor:"orange",color:"#fff",borderRadius:"4px",padding:"4px 8px"}}}),(0,w.jsxs)(f.A,{sx:{display:"flex",justifyContent:"space-between",marginTop:"-10px",fontSize:"0.75rem",color:"text.secondary"},children:[(0,w.jsx)("span",{children:new Date($).toLocaleDateString("es-EC",{year:"numeric",month:"short",day:"numeric"})}),(0,w.jsx)("span",{children:new Date(M).toLocaleDateString("es-EC",{year:"numeric",month:"short",day:"numeric"})})]})]})]}):(0,w.jsxs)(f.A,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"60vh",textAlign:"center",p:3,children:[(0,w.jsx)(u.A,{variant:"h5",gutterBottom:!0,color:"textSecondary",children:"No hay datos de afectaciones"}),(0,w.jsx)(u.A,{variant:"body1",color:"textSecondary",children:"La b\xfasqueda realizada no ha encontrado datos de afectaciones. Por favor, intente con otra fecha, prioridad o criterios de b\xfasqueda."})]})};E.defaultProps={afectData:[],parroquia:[],loading:!1,error:null,coords:[],selectedDate:null,minFecha:null,maxFecha:null,radioAfect:1e3};const $=t.memo(E)}}]);
//# sourceMappingURL=89.567ce2a1.chunk.js.map